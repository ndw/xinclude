<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml" lang="EN" xml:lang="EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><!--Generated by the DeltaXML.com xhtml-outfilter.xsl--><!--Using XSL Processor: Saxonica--><meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" /><title>XML Inclusions (XInclude) Version 1.1</title><style type="text/css"> /**/ code { font-family: monospace; } div.constraint, div.issue, div.note, div.notice { margin-left: 2em; } div.draft-notice { margin-left: 2em; margin-right: 2em; background-color: #FFC0FF; } ol.enumar { list-style-type: decimal; } ol.enumla { list-style-type: lower-alpha; } ol.enumlr { list-style-type: lower-roman; } ol.enumua { list-style-type: upper-alpha; } ol.enumur { list-style-type: upper-roman; } div.exampleInner pre { margin-left: 1em; margin-top: 0em; margin-bottom: 0em} div.exampleOuter {border: 4px double gray; margin: 0em; padding: 0em} div.exampleInner { background-color: #d5dee3; border-top-width: 4px; border-top-style: double; border-top-color: #d3d3d3; border-bottom-width: 4px; border-bottom-style: double; border-bottom-color: #d3d3d3; padding: 4px; margin: 0em } div.exampleWrapper { margin: 4px } div.exampleHeader { font-weight: bold; margin: 4px} /**/ </style><link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-CR.css" /><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><script type="text/javascript">
            function view(doc) {
              var allSpans=document.getElementsByTagName("*");
              if(doc=="old") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  }
                }
              } else if(doc=="new") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                   }
                }
              } else if(doc=="both") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-format" || name=="deltaxml-new-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#90EE90";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid green";
                    }
                  } else if(name=="deltaxml-old" || name=="deltaxml-old-format" || name=="deltaxml-old-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FF5555";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid red";
                    }
                  } else if (name=="add_version" || name=="delete_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="modify_version") {
                    allSpans[i].style.display= displayType;
                  }
                }
              }
            }
  
        </script></head><body><div style="position:fixed; clear:both; top:0px"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a></p></div><div class="head"><p><a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home" alt="W3C" height="48" width="72" /></a></p><h1><a name="title" id="title"></a>XML Inclusions (XInclude) Version 1.1</h1><h2><a name="w3c-doctype" id="w3c-doctype"></a><span class="deltaxml-old" style="background:#FF5555">W3C Candidate Recommendation 30 June 2015</span></h2><h2><a name="w3c-doctype" id="w3c-doctype"></a><span class="deltaxml-new" style="background:#90EE90">W3C Working Draft 12 April 2016</span></h2><dl><dt>This version:</dt><dd><a href="http://www.w3.org/TR/2016/WD-xinclude-11-20160412/">http://www.w3.org/TR/<span class="deltaxml-old" style="background:#FF5555">2015/CR</span><span class="deltaxml-new" style="background:#90EE90">2016/WD</span>-xinclude-11-<span class="deltaxml-old" style="background:#FF5555">20150630</span><span class="deltaxml-new" style="background:#90EE90">20160412</span>/</a></dd><dt>Latest version:</dt><dd><a href="http://www.w3.org/TR/xinclude-11/">http://www.w3.org/TR/xinclude-11/</a></dd><dt>Previous version:</dt><dd><a href="http://www.w3.org/TR/2014/WD-xinclude-11-20141216/">http://www.w3.org/TR/2014/WD-xinclude-11-20141216/</a></dd><dt>Editors:</dt><dd>Jonathan Marsh, Microsoft <a href="mailto:jmarsh@microsoft.com">&lt;jmarsh@microsoft.com&gt;</a></dd><dd>David Orchard, BEA Systems <a href="mailto:dorchard@bea.com">&lt;dorchard@bea.com&gt;</a></dd><dd>Daniel Veillard <a href="mailto:daniel@veillard.com">&lt;daniel@veillard.com&gt;</a> - Second Edition</dd><dd>Norman Walsh, MarkLogic Corporation <a href="mailto:norman.walsh@marklogic.com">&lt;norman.walsh@marklogic.com&gt;</a> - Version 1.1</dd></dl><p>Please refer to the <a href="http://www.w3.org/XML/2014/12/xinclude-errata/"><strong>errata</strong></a> for this document, which may include some normative corrections.</p><p>See also <a href="http://www.w3.org/2003/03/Translations/byTechnology?technology=xinclude10"><strong>translations</strong></a>.</p><p>This document is also available in these non-normative formats: <a href="xinclude-11.xml">XML</a><span class="deltaxml-new" style="background:#90EE90">,</span> <a href="diff10.html"><span class="deltaxml-new" style="background:#90EE90">with color-coded revision indicators from XInclude 1.0</span></a><span class="deltaxml-new" style="background:#90EE90">, </span>and <a href="diffcr.html">with color-coded revision indicators from <span class="deltaxml-old" style="background:#FF5555">XInclude 1.0</span><span class="deltaxml-new" style="background:#90EE90">the previous XInclude 1.1 draft</span></a>.</p><p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p></div><hr /><div><h2><a name="abstract" id="abstract"></a>Abstract</h2><p>This document specifies a processing model and syntax for general purpose inclusion. Inclusion is accomplished by merging a number of XML information sets into a single composite infoset. Specification of the XML documents (infosets) to be merged and control over the merging process is expressed in XML-friendly syntax (elements, attributes, URI references).</p></div><div><h2><a name="status" id="status"></a>Status of this Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current W3C publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/">W3C technical reports index</a> at http://www.w3.org/TR/.</em></p><p>This is a Candidate Recommendation of XInclude 1.1 for review by W3C Members and other interested parties. The Last Call period ended 17 January 2015. There were no comments to this latest Last Call (all previous comments having been incorporated into the Last Call and all commentors having been satisfied).</p><p>XInclude 1.1 adds some upward-compatible enhancements to the <a href="http://www.w3.org/TR/xinclude/">XInclude 1.0 Recommendation</a> as discussed in the <a href="http://www.w3.org/TR/xinclude-11-requirements/">XInclude 1.1 Requirement and Use Cases</a> document. The three key enhancements can be summarized as follows:</p><ul><li><p>added support for a fragment identifier into text/plain content,</p></li><li><p>additional processing to allow for “annotating” the post-included infoset with further information, and</p></li><li><p>allow implementations the flexibility to support additional <code>parse</code> values.</p></li></ul><p>This document has been produced by the <a href="http://www.w3.org/XML/Core/">W3C XML Core Working Group</a> as part of the <a href="http://www.w3.org/XML/Activity">XML Activity</a>. The Working Group expects to advance this Candidate Recommendation to Recommendation Status. We expect to exit the CR period with at least two interoperable implementations of all the features being added as part of XInclude 1.1. We will not exit CR before 25 August 2015 by which time we do expect to have sufficient implementation experience.</p><p>Please send comments about this document to the public <a href="mailto:www-xml-xinclude-comments@w3.org">www-xml-xinclude-comments@w3.org</a> mailing-list; <a href="http://lists.w3.org/Archives/Public/www-xml-xinclude-comments/">archives</a> are available.</p><p>Publication as a Candidate Recommendation does not imply endorsement by the W3C Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p><p>Known implementations are documented in the XInclude Implementation Report at <a href="http://www.w3.org/XML/2013/10/xinclude-11-impl-report/">http://www.w3.org/XML/2013/10/xinclude-11-impl-report/</a>. A Test Suite is maintained at <a href="http://www.w3.org/XML/2013/10/xinclude-11-test-suite/">http://www.w3.org/XML/2013/10/xinclude-11-test-suite/</a> to help in assessing conformance to this specification. The latest release of the Test Suite includes new test cases which implementers can use to check their conformance to the changes included in this new edition.</p><p>This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>. W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/18796/status#disclosures">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.</p><p>This document is governed by the <a id="w3c_process_revision" href="http://www.w3.org/2005/10/Process-20051014/" name="w3c_process_revision">14 October 2005 W3C Process Document</a>.</p></div><div class="toc"><h2><a name="contents" id="contents"></a>Table of Contents</h2><p class="toc"><span>1 <a href="#intro">Introduction</a></span><br /><span>    1.1 <a href="#rel-xlink">Relationship to XLink</a></span><br /><span>    1.2 <a href="#rel-extent">Relationship to XML External Entities</a></span><br /><span>    1.3 <a href="#rel-dtd">Relationship to DTDs</a></span><br /><span>    1.4 <a href="#rel-xsd">Relationship to XML Schemas</a></span><br /><span>    1.5 <a href="#rel-inc">Relationship to Grammar-Specific Inclusions</a></span><br /><span>2 <a href="#terminology">Terminology</a></span><br /><span>3 <a href="#syntax">Syntax</a></span><br /><span>    3.1 <a href="#include_element">xi:include Element</a></span><br /><span>        3.1.1 <a href="#xpointer-and-fragid">The xpointer and fragid attributes</a></span><br /><span>    3.2 <a href="#fallback_element">xi:fallback Element</a></span><br /><span>4 <a href="#processing">Processing Model</a></span><br /><span>    4.1 <a href="#include-location">The Include Location</a></span><br /><span>        4.1.1 <a href="#IRIs">Escaping of href attribute values</a></span><br /><span>        4.1.2 <a href="#content-negotiation">Using XInclude with Content Negotiation</a></span><br /><span>    4.2 <a href="#xml-included-items">Included Items when processing XML</a></span><br /><span>        4.2.1 <a href="#docii">Document Information Items</a></span><br /><span>        4.2.2 <a href="#multiple-nodes">Multiple Nodes</a></span><br /><span>        4.2.3 <a href="#ranges">Range Locations</a></span><br /><span>        4.2.4 <a href="#points">Point Locations</a></span><br /><span>        4.2.5 <a href="#elements">Element, Comment, and Processing Instruction Information Items</a></span><br /><span>        4.2.6 <a href="#attributes">Attribute and Namespace Declaration Information Items</a></span><br /><span>        4.2.7 <a href="#loops">Inclusion Loops</a></span><br /><span>    4.3 <a href="#attribute-copying">Attribute Copying when processing XML</a></span><br /><span>    4.4 <a href="#text-included-items">Included Items when processing text</a></span><br /><span>    4.5 <a href="#other-included-items">Included Items for other values of parse</a></span><br /><span>    4.6 <a href="#fallback">Fallback Behavior</a></span><br /><span>    4.7 <a href="#creating-result">Creating the Result Infoset</a></span><br /><span>        4.7.1 <a href="#unparsed-entities">Unparsed Entities</a></span><br /><span>        4.7.2 <a href="#notations">Notations</a></span><br /><span>        4.7.3 <a href="#references-property">references Property Fixup</a></span><br /><span>        4.7.4 <a href="#namespaces">Namespace Fixup</a></span><br /><span>        4.7.5 <a href="#base">Base URI Fixup</a></span><br /><span>        4.7.6 <a href="#language">Language Fixup</a></span><br /><span>        4.7.7 <a href="#properties">Properties Preserved by the Infoset</a></span><br /><span>5 <a href="#conformance">Conformance</a></span><br /><span>    5.1 <a href="#markup">Markup Conformance</a></span><br /><span>    5.2 <a href="#application">Application Conformance</a></span><br /><span>    5.3 <a href="#infoset">XML Information Set Conformance</a></span><br /></p><h3><a name="appendices" id="appendices"></a>Appendices</h3><p class="toc"><span style="display: none;" class="delete_version"><span>A <a href="#references">References</a></span><br /><span>B <a href="#nn-refs">References</a> (Non-Normative)</span><br /><span>C <a href="#examples">Examples</a> (Non-Normative)</span><br /><span>    C.1 <a href="#basic-example">Basic Inclusion Example</a></span><br /><span>    C.2 <a href="#text-example">Textual Inclusion Example</a></span><br /><span>    C.3 <a href="#xml-as-text-example">Textual Inclusion of XML Example</a></span><br /><span>    C.4 <a href="#fragment-example">Fragment Inclusion Example</a></span><br /><span class="diff-del">    C.5 Range Inclusion Example <i>[This section has been deleted.]</i></span><br /><span>    C.6 <a href="#text-example-2">Textual Inclusion Examples with RFC5147 Fragment Identifiers</a></span><br /><span>    C.7 <a href="#att-copy-example">Attribute Copying Examples</a></span><br /><span>    C.8 <a href="#fallback-example">Fallback Example</a></span><br /></span><span style="display: none;" class="add_version"><span>A <a href="#references">References</a></span><br /><span>B <a href="#nn-refs">References</a> (Non-Normative)</span><br /><span>C <a href="#examples">Examples</a> (Non-Normative)</span><br /><span>    C.1 <a href="#basic-example">Basic Inclusion Example</a></span><br /><span>    C.2 <a href="#text-example">Textual Inclusion Example</a></span><br /><span>    C.3 <a href="#xml-as-text-example">Textual Inclusion of XML Example</a></span><br /><span>    C.4 <a href="#fragment-example">Fragment Inclusion Example</a></span><br /><span class="diff-del">    C.5 Range Inclusion Example <i>[This section has been deleted.]</i></span><br /><span>    C.6 <a href="#text-example-2">Textual Inclusion Examples with RFC5147 Fragment Identifiers</a></span><br /><span>    C.7 <a href="#att-copy-example">Attribute Copying Examples</a></span><br /><span>    C.8 <a href="#fallback-example">Fallback Example</a></span><br /><span>    C.9 <a href="#text-encoding-example">Textual Inclusion Encoding Example</a></span><br /></span><span class="modify_version"><span>A <a href="#references">References</a></span><br /><span>B <a href="#nn-refs">References</a> (Non-Normative)</span><br /><span>C <a href="#examples">Examples</a> (Non-Normative)</span><br /><span>    C.1 <a href="#basic-example">Basic Inclusion Example</a></span><br /><span>    C.2 <a href="#text-example">Textual Inclusion Example</a></span><br /><span>    C.3 <a href="#xml-as-text-example">Textual Inclusion of XML Example</a></span><br /><span>    C.4 <a href="#fragment-example">Fragment Inclusion Example</a></span><br /><span class="diff-del">    C.5 Range Inclusion Example <i>[This section has been deleted.]</i></span><br /><span>    C.6 <a href="#text-example-2">Textual Inclusion Examples with RFC5147 Fragment Identifiers</a></span><br /><span>    C.7 <a href="#att-copy-example">Attribute Copying Examples</a></span><br /><span>    C.8 <a href="#fallback-example">Fallback Example</a></span><br /><span><span class="deltaxml-new" style="background:#90EE90">    C.9 </span><a href="#text-encoding-example"><span class="deltaxml-new" style="background:#90EE90">Textual Inclusion Encoding Example</span></a></span><br /></span></p></div><hr /><div class="body"><div class="div1"><h2><a name="intro" id="intro"></a>1 Introduction</h2><p>Many programming languages provide an inclusion mechanism to facilitate modularity. Markup languages also often have need of such a mechanism. This specification introduces a generic mechanism for merging XML documents (as represented by their information sets) for use by applications that need such a facility. The syntax leverages existing XML constructs - elements, attributes, and URI references.</p><div class="div2"><h3><a name="rel-xlink" id="rel-xlink"></a>1.1 Relationship to XLink</h3><p>XInclude differs from the linking features described in the <a href="#XLink">[XML Linking Language]</a>, specifically links with the attribute value <code>show="embed"</code>. Such links provide a media-type independent syntax for indicating that a resource is to be embedded graphically within the display of the document. XLink does not specify a specific processing model, but simply facilitates the detection of links and recognition of associated metadata by a higher level application.</p><p>XInclude, on the other hand, specifies a media-type specific (XML into XML) transformation. It defines a specific processing model for merging information sets. XInclude processing occurs at a low level, often by a generic XInclude processor which makes the resulting information set available to higher level applications.</p><p>Simple information item inclusion as described in this specification differs from transclusion, which preserves contextual information such as style.</p></div><div class="div2"><h3><a name="rel-extent" id="rel-extent"></a>1.2 Relationship to XML External Entities</h3><p>There are a number of differences between XInclude and <a href="#XML">[XML 1.0]</a> or <a href="#XML11">[XML 1.1]</a> external entities which make them complementary technologies.</p><p>Processing of external entities (as with the rest of DTDs) occurs at parse time. XInclude operates on information sets and thus is orthogonal to parsing.</p><p>Declaration of external entities requires a DTD or internal subset. This places a set of dependencies on inclusion, for instance, the syntax for the DOCTYPE declaration requires that the document element be named - orthogonal to inclusion in many cases. Validating parsers must have a complete content model defined. XInclude is orthogonal to validation and the name of the document element.</p><p>External entities provide a level of indirection - the external entity must be declared and named, and separately invoked. XInclude uses direct references. Applications which generate XML output incrementally can benefit from not having to pre-declare inclusions.</p><p>Failure to load an external entity is normally a fatal error. XInclude allows the author to provide default content that will be used if the remote resource cannot be loaded.</p><p>The syntax for an internal subset is cumbersome to many authors of simple well-formed XML documents. XInclude syntax is based on familiar XML constructs.</p></div><div class="div2"><h3><a name="rel-dtd" id="rel-dtd"></a>1.3 Relationship to DTDs</h3><p>XInclude defines no relationship to DTD validation. XInclude describes an infoset-to-infoset transformation and not a change in XML parsing behavior. XInclude does not define a mechanism for DTD validation of the resulting infoset.</p></div><div class="div2"><h3><a name="rel-xsd" id="rel-xsd"></a>1.4 Relationship to XML Schemas</h3><p>XInclude defines no relationship to the augmented infosets produced by applying an XML schema. Such an augmented infoset can be supplied as the input infoset, or such augmentation might be applied to the infoset resulting from the inclusion.</p></div><div class="div2"><h3><a name="rel-inc" id="rel-inc"></a>1.5 Relationship to Grammar-Specific Inclusions</h3><p>Special-purpose inclusion mechanisms have been introduced into specific XML grammars. XInclude provides a generic mechanism for recognizing and processing inclusions, and as such can offer a simpler overall authoring experience, greater performance, and less code redundancy.</p></div></div><div class="div1"><h2><a name="terminology" id="terminology"></a>2 Terminology</h2><p>[<a name="dt-must" id="dt-must" title="Must, May, etc.">Definition</a>: The key words <b>must</b>, <b>must not</b>, <b>required</b>, <b>shall</b>, <b>shall not</b>, <b>should</b>, <b>should not</b>, <b>recommended</b>, <b>may</b>, and <b>optional</b> in this specification are to be interpreted as described in <a href="#RFC2119">[IETF RFC 2119]</a>.]</p><p>[<a name="dt-infoset" id="dt-infoset" title="infoset">Definition</a>: The term <b>information set</b> refers to the output of an <a href="#XML">[XML 1.0]</a> or <a href="#XML11">[XML 1.1]</a> processor, expressed as a collection of information items and properties as defined by the <a href="#XMLIS">[XML Information Set]</a> specification.] In this document the term <em>infoset</em> is used as a synonym for <em>information set</em>.</p><p>[<a name="dt-error" id="dt-error" title="fatal error">Definition</a>: The term <b>fatal error</b> refers to the presence of factors that prevent normal processing from continuing.] [<a name="dt-resource-error" id="dt-resource-error" title="resource error">Definition</a>: The term <b>resource error</b> refers to a failure of an attempt to fetch a resource from a URL.] [<a name="dt-recoverable-error" id="dt-recoverable-error" title="recoverable error">Definition</a>: The term <b>recoverable error</b> refers to the presence of factors which are erroneous, but for which this specification prescribes specific recovery behavior.] XInclude processors <a title="Must, May, etc." href="#dt-must">must</a> stop processing when encountering <a title="fatal error" href="#dt-error">fatal errors</a>; <a title="resource error" href="#dt-resource-error">resource errors</a><a title="Must, May, etc." href="#dt-must">must</a> be handled as described in <a href="#fallback"><b>4.6 Fallback Behavior</b></a>; <a title="recoverable error" href="#dt-recoverable-error">recoverable errors</a><a title="Must, May, etc." href="#dt-must">must</a> be handled as specified.</p></div><div class="div1"><h2><a name="syntax" id="syntax"></a>3 Syntax</h2><p>XInclude 1.1 defines two namespaces:</p><ul><li><p>The namespace <code>http://www.w3.org/2001/XInclude</code> contains two elements with the local names <code>include</code> and <code>fallback</code>. For convenience, within this specification these elements are referred to as <code>xi:include</code> and <code>xi:fallback</code> respectively.</p></li><li><p>The namespace <code>http://www.w3.org/2001/XInclude/local-attributes</code> is used for copying attributes that are not in a namespace, see <a href="#attribute-copying"><b>4.3 Attribute Copying when processing XML</b></a>. <span>For convenience, within this specification, the prefix <code>xila</code> is used when referring to elements within this namespace.</span></p></li></ul><p>The following (non-normative) XML schema <a href="#XMLSchemas">[XML Schemas]</a> illustrates the content model of the <code>xi</code> namespace:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           xmlns:xi="http://www.w3.org/2001/XInclude"
           targetNamespace="http://www.w3.org/2001/XInclude"
           finalDefault="extension"&gt;

  &lt;xs:element name="include" type="xi:includeType" /&gt;

  &lt;xs:complexType name="includeType" mixed="true"&gt;
    &lt;xs:choice minOccurs="0" maxOccurs="unbounded" &gt;
      &lt;xs:element ref="xi:fallback" /&gt;
      &lt;xs:any namespace="##other" processContents="lax" /&gt;
      &lt;xs:any namespace="##local" processContents="lax" /&gt;
    &lt;/xs:choice&gt;
    &lt;xs:attribute name="href" use="optional" type="xs:anyURI"/&gt;
    &lt;xs:attribute name="parse" use="optional" default="xml"
                  type="xs:string" /&gt;
    &lt;xs:attribute name="xpointer" use="optional" type="xs:string"/&gt;
    &lt;xs:attribute name="fragid" use="optional" type="xs:string"/&gt;
    <span>&lt;xs:attribute name="set-xml-id" use="optional" type="xs:string"/&gt;</span>
    &lt;xs:attribute name="encoding" use="optional" type="xs:string"/&gt;
    &lt;xs:attribute name="accept" use="optional" type="xs:string"/&gt;
    &lt;xs:attribute name="accept-language" use="optional" type="xs:string"/&gt;
    &lt;xs:anyAttribute namespace="##other" processContents="lax"/&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:element name="fallback" type="xi:fallbackType" /&gt;

  &lt;xs:complexType name="fallbackType" mixed="true"&gt;
    &lt;xs:choice minOccurs="0" maxOccurs="unbounded"&gt;
      &lt;xs:element ref="xi:include"/&gt;
      &lt;xs:any namespace="##other" processContents="lax"/&gt;
      &lt;xs:any namespace="##local" processContents="lax"/&gt;
    &lt;/xs:choice&gt;
    &lt;xs:anyAttribute namespace="##other" processContents="lax" /&gt;
  &lt;/xs:complexType&gt;

&lt;/xs:schema&gt;
</pre></div><div class="div2"><h3><a name="include_element" id="include_element"></a>3.1 xi:include Element</h3><p>The <code>xi:include</code> element has the following attributes:</p><dl><dt class="label">href</dt><dd><p>A value which, after appropriate escaping (see <a href="#IRIs"><b>4.1.1 Escaping of href attribute values</b></a>) has been performed, results in a URI reference or an <a title="IRI reference" href="#dt-IRI">IRI reference</a> specifying the location of the resource to include. The <code>href</code> attribute is optional; the absence of this attribute is the same as specifying <code>href=""</code>, that is, the reference is to the same document. If the <code>href</code> attribute is absent when XML processing is specified, the <code>xpointer</code> or <code>fragid</code> attribute <a title="Must, May, etc." href="#dt-must">must</a> be present. Fragment identifiers <a title="Must, May, etc." href="#dt-must">must not</a> be used; their appearance is a <a title="fatal error" href="#dt-error">fatal error</a>. A value that results in a syntactically invalid URI or IRI <a title="Must, May, etc." href="#dt-must">should</a> be reported as a <a title="fatal error" href="#dt-error">fatal error</a>, but some implementations may find it impractical to distinguish this case from a <a title="resource error" href="#dt-resource-error">resource error</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>A URI ending in <code>#</code> is considered by <a href="#RFC2396">[IETF RFC 2396]</a> to have an empty fragment identifier. Such a URI would result in a <a title="fatal error" href="#dt-error">fatal error</a> as described above.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>A key feature of XInclude is that it allows a resource to be cast to a user-specifed type for inclusion. The returned media type is therefore essentially ignored for the purposes of inclusion processing, and the syntax of the fragment identifier of the returned media type will generally not be applicable to the user-specified type. Therefore, in XInclude, subresources of the included resource are identified by a separate <code>xpointer</code> or <code>fragid</code> attribute which is applied after the casting takes place.</p></div></dd><dt class="label">parse</dt><dd><p>Indicates how to parse the included resource. The parse attribute allows XInclude to give the author of the including document priority over the server of the included document in terms of how to process the included content. With two exceptions, the value of the <code>parse</code> attribute <a title="Must, May, etc." href="#dt-must">must</a> conform to the requirements of a <em>media type</em>, see <a href="#RFC4288">[IETF RFC 4288]</a>. The exceptions are “<code>xml</code>” which <a title="Must, May, etc." href="#dt-must">must</a> be treated as “<code>application/xml</code>” and “<code>text</code>”, which <a title="Must, May, etc." href="#dt-must">must</a> be treated as “<code>text/plain</code>”.</p><p>Implementations <a title="Must, May, etc." href="#dt-must">must</a> process the value of the <code>parse</code> attribute with standard media type rules: if the media type is recognized, process it as that media type; if the suffix is recognized, process it in accordance with that suffix; and finally, if the family is recognized, process it in accordance with that family.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In accordance with these rules, a media type of “<code>application/unknown+xml</code>” will be treated as XML (i.e. <code>application/xml</code>), whereas a media type of “<code>text/unknown</code>” will be treated as text (i.e. <code>text/plain</code>).</p></div><p>A value of “<code>xml</code>”, “<code>application/xml</code>”, or a value with the “<code>+xml</code>” suffix indicates that the resource <a title="Must, May, etc." href="#dt-must">must</a> be parsed as XML and the infosets merged. A value of “<code>text</code>”, “<code>text/plain</code>”, or a value in the “<code>text</code>” family indicates that the resource <a title="Must, May, etc." href="#dt-must">must</a> be included as the character information items. This attribute is optional. When omitted, the value of “<code>application/xml</code>” is implied. Values that specify neither XML processing nor text processing are implementation-defined.</p><p>Implementations <a title="Must, May, etc." href="#dt-must">must</a> treat values of the <code>parse</code> attribute that it does not recognize as a <a title="recoverable error" href="#dt-recoverable-error">recoverable error</a> and handle the <code>xi:include</code> element as described in <a href="#fallback"><b>4.6 Fallback Behavior</b></a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>For interoperability between validating and non-validating systems, whitespace <a title="Must, May, etc." href="#dt-must">should not</a> appear in the parse attribute.</p></div></dd><dt class="label">xpointer</dt><dd><p>When the <code>parse</code> attribute specifies XML processing, the XPointer (see <a href="#XPCore">[XPointer Framework]</a>) contained in the <code>xpointer</code> attribute is evaluated to identify a portion of the resource to include.</p><p>See <a href="#xpointer-and-fragid"><b>3.1.1 The xpointer and fragid attributes</b></a> for more information.</p></dd><dt class="label">fragid</dt><dd><p>The <code>fragid</code> attribute is a generalization of the <code>xpointer</code> attribute. A <code>fragid</code> may be present regardless of the value of the <code>parse</code> attribute. The interpretation of the value of the attribute depends on the value of <code>parse</code>. For XML processing, the value is interpreted as an XPointer (see <a href="#XPCore">[XPointer Framework]</a>); for text processing, it is interpreted as a <a href="#RFC5147">[IETF RFC 5147]</a> fragment identifier. For other values of <code>parse</code>, implementations <a title="Must, May, etc." href="#dt-must">should</a> process fragment identifiers per the relevant media type (i.e., media types registered per <a href="#RFC4288">[IETF RFC 4288]</a>), but the interpretation is not defined by this specification.</p><p>See <a href="#xpointer-and-fragid"><b>3.1.1 The xpointer and fragid attributes</b></a> for more information.</p></dd><dt class="label">set-xml-id</dt><dd><p>The <code>set-xml-id</code> attribute applies only when parsing XML. It is a <a title="fatal error" href="#dt-error">fatal error</a> to specify the <code>set-xml-id</code> attribute when text processing is specified. If the <code>set-xml-id</code> attribute is specified on <code>xi:include</code>:</p><ul><li><p>When the value of the <code>set-xml-id</code> attribute is not the empty string, an <code>xml:id</code> attribute will be added to all <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> that are <em>element information items</em>. The value of the <code>xml:id</code> attribute will be the value of the <code>set-xml-id</code> attribute on the <code>xi:include</code> element.</p><p>If a <a title="top-level included items" href="#dt-top-level-included-items">top-level included item</a> has an <code>xml:id</code> attribute, its value will be changed to the value of the <code>set-xml-id</code> attribute.</p></li><li><p>When the value of the <code>set-xml-id</code> attribute is the empty string, the <code>xml:id</code> attribute will be removed from all <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a>, if it is present.</p></li></ul></dd><dt class="label">encoding</dt><dd><p>For non-XML processing, the <code>encoding</code> attribute specifies how the resource is to be translated. The value of this attribute <a title="Must, May, etc." href="#dt-must">should</a> be a valid encoding name. The <code>encoding</code> attribute has no effect when processing the resource as XML.</p></dd><dt class="label">accept</dt><dd><p>The value of the <code>accept</code> attribute may be used by the XInclude processor to aid in content negotiation. When the XInclude processor fetches a resource via HTTP, it <a title="Must, May, etc." href="#dt-must">should</a> place the value of the <code>accept</code> attribute, if one exists, in the HTTP request as an <code>Accept</code> header as described in section 14.1 of <a href="#RFC2616">[IETF RFC 2616]</a>. Values containing characters outside the range #x20 through #x7E are disallowed in HTTP headers, and <a title="Must, May, etc." href="#dt-must">must</a> be flagged as <a title="fatal error" href="#dt-error">fatal errors</a>.</p></dd><dt class="label">accept-language</dt><dd><p>The value of the <code>accept-language</code> attribute may be used by the XInclude processor to aid in content negotiation. When the XInclude processor fetches a resource via HTTP, it <a title="Must, May, etc." href="#dt-must">should</a> place the value of the <code>accept-language</code> attribute, if one exists, in the HTTP request as an <code>Accept-Language</code> header as described in section 14.4 of <a href="#RFC2616">[IETF RFC 2616]</a>. Values containing characters outside the range #x20 through #x7E are disallowed in HTTP headers, and <a title="Must, May, etc." href="#dt-must">must</a> be flagged as <a title="fatal error" href="#dt-error">fatal errors</a>.</p></dd><dt class="label"><em>Any attributes in the <code>http://www.w3.org/2001/XInclude/local-attributes</code> namespace</em></dt><dd><p>These attributes are used for copying values into attributes that are not in any namespace, see <a href="#attribute-copying"><b>4.3 Attribute Copying when processing XML</b></a>.</p></dd></dl><p>Attributes other than those listed above <a title="Must, May, etc." href="#dt-must">may</a> be placed on the <code>xi:include</code> element. Unprefixed attribute names are reserved for future versions of this specification and <a title="Must, May, etc." href="#dt-must">must</a> be ignored by XInclude 1.1 processors.</p><p>The <em>children</em> property of the <code>xi:include</code> element <a title="Must, May, etc." href="#dt-must">may</a> include a single <code>xi:fallback</code> element; the appearance of more than one <code>xi:fallback</code> element, an <code>xi:include</code> element, or any other element from the XInclude namespace is a <a title="fatal error" href="#dt-error">fatal error</a>. Other content (text, processing instructions, comments, elements not in the XInclude namespace, descendants of child elements) is not constrained by this specification and is ignored by the XInclude processor, that is, it has no effect on include processing, and does not appear in the <em>children</em> properties of the result infoset. Such content might be used by applications analyzing a pre-inclusion infoset, or be made available to an application post-inclusion through means other than the normal infoset properties.</p><p>The following (non-normative) DTD fragment illustrates a sample declaration for the <code>xi:include</code> element:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;!ELEMENT xi:include (xi:fallback?)&gt;
&lt;!ATTLIST xi:include
    xmlns:xi        CDATA       #FIXED    "http://www.w3.org/2001/XInclude"
<span>    xmlns:xila      CDATA       #FIXED    "http://www.w3.org/2001/XInclude/local-attributes"</span>
    href            CDATA       #IMPLIED
    parse           CDATA       "application/xml"
    xpointer        CDATA       #IMPLIED
    fragid          CDATA       #IMPLIED
<span>    set-xml-id      CDATA       #IMPLIED</span>
    encoding        CDATA       #IMPLIED
    accept          CDATA       #IMPLIED
    accept-language CDATA       #IMPLIED
&gt;
</pre></div><div class="div3"><h4><a name="xpointer-and-fragid" id="xpointer-and-fragid"></a>3.1.1 The xpointer and fragid attributes</h4><p>The <code>xpointer</code> and <code>fragid</code> attributes identify a portion of a resource to include.</p><p>If both <code>xpointer</code> and <code>fragid</code> are specified, they <a title="Must, May, etc." href="#dt-must">should</a> be the same. It is a <a title="recoverable error" href="#dt-recoverable-error">recoverable error</a> if they are not the same; to recover, if the <code>parse</code> attribute specifies XML processing, then the <code>xpointer</code> attribute is used; otherwise the <code>fragid</code> attribute is used.</p><p>The <code>xpointer</code> attribute <a title="Must, May, etc." href="#dt-must">must not</a> be present when text processing is specified. It is a <a title="fatal error" href="#dt-error">fatal error</a> to specify the <code>xpointer</code> attribute when text processing is specified.</p><p>The <code>xpointer</code> and <code>fragid</code> attribute are optional. When neither is specified:</p><ul><li><p>the <code>href</code> attribute <a title="Must, May, etc." href="#dt-must">must</a> be present and</p></li><li><p>the entire resource is included.</p></li></ul><p>It is a <a title="fatal error" href="#dt-error">fatal error</a> if neither the <code>xpointer</code> nor <code>fragid</code> attributes are present and the <code>href</code> attribute is not present.</p><p>Neither the <code>xpointer</code> nor <code>fragid</code> attributes contain a URI reference, and %-escaping is not done in XPointers, so '%' is an ordinary character in the value of the <code>xpointer</code> and <code>fragid</code> attributes.</p></div></div><div class="div2"><h3><a name="fallback_element" id="fallback_element"></a>3.2 xi:fallback Element</h3><p>The <code>xi:fallback</code> element appears as a child of an <code>xi:include</code> element. It provides a mechanism for recovering from missing resources. When a <a title="resource error" href="#dt-resource-error">resource error</a> is encountered, the <code>xi:include</code> element is replaced with the contents of the <code>xi:fallback</code> element. If the <code>xi:fallback</code> element is empty, the <code>xi:include</code> element is removed from the result. If the <code>xi:fallback</code> element is missing, a <a title="resource error" href="#dt-resource-error">resource error</a> results in a <a title="fatal error" href="#dt-error">fatal error</a>.</p><p>The content of <code>xi:fallback</code> elements is ignored unless a <a title="resource error" href="#dt-resource-error">resource error</a> occurs while processing the surrounding <code>xi:include</code> element. In particular, apparent <a title="fatal error" href="#dt-error">fatal errors</a> caused by the presence, absence, or content of elements and attributes inside the <code>xi:fallback</code> element <a title="Must, May, etc." href="#dt-must">must not</a> be reported in <code>xi:fallback</code> elements that are ignored.</p><p>The <code>xi:fallback</code> element can appear only as a child of an <code>xi:include</code> element. It is a <a title="fatal error" href="#dt-error">fatal error</a> for an <code>xi:fallback</code> element that is not being ignored to appear in a document anywhere other than as the direct child of the <code>xi:include</code> (before inclusion processing on the contents of the element.) It is a <a title="fatal error" href="#dt-error">fatal error</a> for an <code>xi:fallback</code> element that is not being ignored to contain any elements from the XInclude namespace other than <code>xi:include</code>.</p><p>Attributes <a title="Must, May, etc." href="#dt-must">may</a> be placed on the <code>xi:fallback</code> element. Unprefixed attribute names are reserved for future versions of this specification and <a title="Must, May, etc." href="#dt-must">must</a> be ignored by XInclude 1.1 processors.</p><p>The following (non-normative) DTD fragment illustrates a sample declaration for the <code>xi:fallback</code> element:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;!ELEMENT xi:fallback ANY&gt;
&lt;!ATTLIST xi:fallback
    xmlns:xi   CDATA   #FIXED   "http://www.w3.org/2001/XInclude"
&gt;
</pre></div></div></div><div class="div1"><h2><a name="processing" id="processing"></a>4 Processing Model</h2><p>Inclusion as defined in this document is a specific type of <a href="#XMLIS">[XML Information Set]</a> transformation.</p><p>[<a name="dt-source-infoset" id="dt-source-infoset" title="source infoset">Definition</a>: The input for the inclusion transformation consists of a <b>source infoset</b>.] [<a name="dt-result-infoset" id="dt-result-infoset" title="result infoset">Definition</a>: The output, called the <b>result infoset</b>, is a new infoset which merges the source infoset with the infosets of resources identified by URI references or IRI references appearing in <code>xi:include</code> elements.] Thus a mechanism to resolve URIs or IRIs and return the identified resources as infosets is assumed. Well-formed XML entities that do not have defined infosets (e.g. an external entity with multiple top-level elements) are outside the scope of this specification, either for use as a <a title="source infoset" href="#dt-source-infoset">source infoset</a> or the <a title="result infoset" href="#dt-result-infoset">result infoset</a>.</p><p><code>xi:include</code> elements in the source infoset serve as inclusion transformation instructions. [<a name="dt-top-level-included-items" id="dt-top-level-included-items" title="top-level included items">Definition</a>: The information items located by the <code>xi:include</code> element are called the <b>top-level included items</b> ]. [<a name="dt-included-items" id="dt-included-items" title="included items">Definition</a>: The <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> together with their attributes, namespaces, and descendants, are called the <b>included items</b> ]. The <a title="result infoset" href="#dt-result-infoset">result infoset</a> is essentially a copy of the <a title="source infoset" href="#dt-source-infoset">source infoset</a>, with each <code>xi:include</code> element and its descendants replaced by its corresponding <a title="included items" href="#dt-included-items">included items</a>.</p><div class="div2"><h3><a name="include-location" id="include-location"></a>4.1 The Include Location</h3><p>The value of the <code>href</code> attribute, after escaping according to <a href="#IRIs"><b>4.1.1 Escaping of href attribute values</b></a>, is interpreted as either a URI reference or an <a title="IRI reference" href="#dt-IRI">IRI reference</a>. The base URI for relative URIs or IRIs is the base URI of the <code>xi:include</code> element as specified in <a href="#XMLBase">[XML Base]</a>. [<a name="dt-include-location" id="dt-include-location" title="include location">Definition</a>: The URI or IRI resulting from resolution of the normalized value of the <code>href</code> attribute (or the empty string if no attribute appears) to absolute URI or IRI form is called the <b>include location</b>.]</p><p>The absence of a value for the <code>href</code> attribute, either by the appearance of <code>href=""</code> or by the absence of the <code>href</code> attribute, represents a case which may be incompatible with certain implementation strategies. For instance, an XInclude processor might not have a textual representation of the <a title="source infoset" href="#dt-source-infoset">source infoset</a> to include as text, or it may be unable to access another part of the document when parsing as XML and using an xpointer because of streamability concerns. An implementation <a title="Must, May, etc." href="#dt-must">may</a> choose to treat any or all absences of a value for the <code>href</code> attribute as <a title="resource error" href="#dt-resource-error">resource errors</a>. Implementations <a title="Must, May, etc." href="#dt-must">should</a> document the conditions under which such <a title="resource error" href="#dt-resource-error">resource errors</a> occur.</p><div class="div3"><h4><a name="IRIs" id="IRIs"></a>4.1.1 Escaping of <code>href</code> attribute values</h4><p>The value of this attribute is an XML resource identifier as defined in <a href="#XML11">[XML 1.1]</a> section 4.2.2 "External Entities", which is interpreted as [<a name="dt-IRI" id="dt-IRI" title="IRI reference">Definition</a>: an IRI Reference as defined in RFC 3987 <a href="#RFC3987">[IETF RFC 3987]</a>], after the escaping procedure described in <a href="#XML11">[XML 1.1]</a> section 4.2.2 is applied. If necessary for the implementation, the value may be further converted to a URI reference as described in <a href="#XML11">[XML 1.1]</a>.</p></div><div class="div3"><h4><a name="content-negotiation" id="content-negotiation"></a>4.1.2 Using XInclude with Content Negotiation</h4><p>The use of a mechanism like HTTP <a href="#RFC2616">[IETF RFC 2616]</a> content negotiation introduces an additional level of potential complexity into the use of XInclude. Developers who use XInclude in situations where content negotiation is likely or possible should be aware of the possibility that they will be including content that may differ structurally from the content they expected, even if that content is XML. For example, a single URI or IRI may variously return a raw XML representation of the resource, an XSL-FO <a href="#XSL-FO">[XSL-FO]</a> representation, or an XHTML <a href="#XHTML">[XHTML]</a> representation, as well as versions in different character encodings or languages.</p><p>Authors whose XInclude processing depends on the receipt of a particular vocabulary of XML can use the <code>accept</code> and <code>accept-language</code> attributes to increase the probability that the resource is provided in the expected format.</p></div></div><div class="div2"><h3><a name="xml-included-items" id="xml-included-items"></a>4.2 Included Items when processing XML</h3><p>When processing XML, the <a title="include location" href="#dt-include-location">include location</a> is dereferenced, the resource is fetched, and an infoset is created by parsing the resource as if the media type were application/xml (including character encoding determination).</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The specifics of how an infoset is created are intentionally unspecified, to allow for flexibility by implementations and to avoid defining a particular processing model for components of the XML architecture. Particulars of whether DTD or XML schema validation are performed, for example, are not constrained by this specification.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>The character encodings of the including and included resources can be different. This does not affect the resulting infoset, but might need to be taken into account during any subsequent serialization.</p></div><p>Resources that are unavailable for any reason (for example the resource doesn't exist, connection difficulties or security restrictions prevent it from being fetched, the URI scheme isn't a fetchable one, the resource is in an unsupported encoding, or the resource is determined through implementation-specific mechanisms not to be XML) result in a <a title="resource error" href="#dt-resource-error">resource error</a>. Resources that contain non-well-formed XML result in a <a title="fatal error" href="#dt-error">fatal error</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The distinction between a resource error and a fatal error is somewhat implementation-dependent. Consider an include location returning an HTML document, perhaps as an error page. One processor might determine that no infoset can be created from the resource (by examining the media type, for example) and raise a resource error, enabling fallback behavior. Another processor with no such heuristics might attempt to parse the non-XML resource as XML and encounter a well-formedness (fatal) error.</p></div><p>[<a name="dt-acquired-infoset" id="dt-acquired-infoset" title="acquired infoset">Definition</a>: <code>xi:include</code> elements in this infoset are recursively processed to create the <b>acquired infoset</b>. For an intra-document reference (via <code>xpointer</code> attribute) the <a title="source infoset" href="#dt-source-infoset">source infoset</a> is used as the acquired infoset.]</p><p>[<a name="dt-inclusion-target" id="dt-inclusion-target" title="inclusion target">Definition</a>: The portion of the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a> to be included is called the <b>inclusion target</b>.] The <em>document information item</em> of the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a> serves as the <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> unless the <code>xpointer</code> attribute is present and identifies a subresource. XPointers of the forms described in <a href="#XPCore">[XPointer Framework]</a> and <a href="#XPElement">[XPointer element() scheme]</a><a title="Must, May, etc." href="#dt-must">must</a> be supported. XInclude processors optionally support other forms of XPointer such as those in the <a href="http://www.w3.org/2005/04/xpointer-schemes/">XPointer Registry</a>. An error in the XPointer is a <a title="resource error" href="#dt-resource-error">resource error</a>.</p><p>The set of <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> is derived from the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a> as follows.</p><div class="div3"><h4><a name="docii" id="docii"></a>4.2.1 Document Information Items</h4><p>The <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> might be a <em>document information item</em> (for instance, no specified <code>xpointer</code> attribute, or an XPointer specifically locating the document root.) In this case, the set of <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> is the <em>children</em> of the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset's</a> document information item, except for the <em>document type declaration information item</em> child, if one exists.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The XML Information Set specification does not provide for preservation of white space outside the document element. XInclude makes no further provision to preserve this white space.</p></div></div><div class="div3"><h4><a name="multiple-nodes" id="multiple-nodes"></a>4.2.2 Multiple Nodes</h4><p>The <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> might consist of more than a single node. In this case the set of <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> is the set of information items from the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a> corresponding to the nodes referred to by the XPointer, in the order in which they appear in the acquired infoset.</p></div><div class="div3"><h4><a name="ranges" id="ranges"></a>4.2.3 Range Locations</h4><p>The <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> might be a location set that represents a range or a set of ranges.</p><p>Each range corresponds to a set of information items in the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a>. [<a name="dt-selected" id="dt-selected" title="selected">Definition</a>: An information item is said to be <b>selected</b> by a range if it occurs after (in document order) the starting point of the range and before the ending point of the range.] [<a name="dt-partially-selected" id="dt-partially-selected" title="partially selected">Definition</a>: An information item is said to be <b>partially selected</b> by a range if it contains only the starting point of the range, or only the ending point of the range.] By definition, a character information item cannot be <a title="partially selected" href="#dt-partially-selected">partially selected</a>.</p><p>The set of <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> is the union, in document order with duplicates removed, of the information items either <a title="selected" href="#dt-selected">selected</a> or <a title="partially selected" href="#dt-partially-selected">partially selected</a> by the range. The <em>children</em> property of <a title="selected" href="#dt-selected">selected</a> information items is not modified. The <em>children</em> property of <a title="partially selected" href="#dt-partially-selected">partially selected</a> information items is the set of information items that are in turn either <a title="selected" href="#dt-selected">selected</a> or <a title="partially selected" href="#dt-partially-selected">partially selected</a>, and so on.</p></div><div class="div3"><h4><a name="points" id="points"></a>4.2.4 Point Locations</h4><p>The <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> might be a location set that represents a point. In this case the set of <a title="included items" href="#dt-included-items">included items</a> is empty.</p></div><div class="div3"><h4><a name="elements" id="elements"></a>4.2.5 Element, Comment, and Processing Instruction Information Items</h4><p>The <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> might be an element node, a comment node, or a processing instruction node, respectively representing an <em>element information item</em>, a <em>comment information item</em>, or a <em>processing instruction information item</em>. In this case the set of <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> consists of the information item corresponding to the element, comment, or processing instruction node in the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a>.</p></div><div class="div3"><h4><a name="attributes" id="attributes"></a>4.2.6 Attribute and Namespace Declaration Information Items</h4><p>It is a <a title="fatal error" href="#dt-error">fatal error</a> for the <a title="inclusion target" href="#dt-inclusion-target">inclusion target</a> to be an attribute node or a namespace node.</p></div><div class="div3"><h4><a name="loops" id="loops"></a>4.2.7 Inclusion Loops</h4><p>When recursively processing an <code>xi:include</code> element, it is a <a title="fatal error" href="#dt-error">fatal error</a> to process another <code>xi:include</code> element with an <a title="include location" href="#dt-include-location">include location</a> and <code>xpointer</code> attribute value that have already been processed in the inclusion chain.</p><p>In other words, the following are all legal:</p><ul><li><p>An <code>xi:include</code> element <a title="Must, May, etc." href="#dt-must">may</a> reference the document containing the include element, when processing text.</p></li><li><p>An <code>xi:include</code> element <a title="Must, May, etc." href="#dt-must">may</a> identify a different part of the same local resource (same <code>href</code>, different <code>xpointer</code>).</p></li><li><p>Two non-nested <code>xi:include</code> elements <a title="Must, May, etc." href="#dt-must">may</a> identify a resource which itself contains an <code>xi:include</code> element.</p></li></ul><p>The following are illegal:</p><ul><li><p>An <code>xi:include</code> element pointing to itself or any ancestor thereof, when processing XML.</p></li><li><p>An <code>xi:include</code> element pointing to any include element or ancestor thereof which has already been processed at a higher level.</p></li></ul></div></div><div class="div2"><h3><a name="attribute-copying" id="attribute-copying"></a>4.3 Attribute Copying when processing XML</h3><p>XInclude can introduce validity errors into a document. In particular, if a resource containing element information items is included more than once, and if any of those element information items have attributes of type ID, then the <a title="result infoset" href="#dt-result-infoset">result infoset</a> will contain multiple IDs with the same value.</p><p>Some applications will want to attempt to resolve these sorts of errors and different applications will want to do so in different ways. In order to facilitate this kind of processing, XInclude 1.1 introduces a new feature: attribute copying.</p><p>The effect of attribute copying depends on the namespace of the attribute on the <code>xi:include</code> element.</p><ul><li><p>If the attribute is not in a namespace or is in the <code>xml:</code> namespace, it is ignored by attribute copying.</p></li><li><p>If the attribute is in the <code>http://www.w3.org/2001/XInclude/local-attributes</code> namespace, it is copied <em>without its namespace</em> onto every <a title="" href="#">top-level included item</a> that is an element information item. In other words an attribute with the local name <code>foo</code> and the namespace name <code>http://www.w3.org/2001/XInclude/local-attributes</code> on the <code>xi:include</code> element will be copied as an attribute with the local name <code>foo</code> in no namespace.</p></li><li><p>Any other attributes that appear on the <code>xi:include</code> element will be copied onto every <a title="" href="#">top-level included item</a> that is an element information item.</p></li></ul><p>In all cases when an attribute is copied, if the element information item already has an attribute with the same name, its value is changed to the value specified on the <code>xi:include</code> element.</p><p>What this means in practice is that an author can use namespace qualified attributes on the <code>xi:include</code> elements to pass information through to the XIncluded document. Subsequent processing on the XIncluded document can use this information to repair any errors introduced. For example, an attribute could be used to indicate how duplicate IDs are to be repaired.</p><p>Also, while attributes in <code>xml:</code> namespace are not copied, it is possible to use the <code>set-xml-id</code> attribute to change <code>xml:id</code> attributes on XIncluded elements.</p></div><div class="div2"><h3><a name="text-included-items" id="text-included-items"></a>4.4 Included Items when processing text</h3><p>When processing text, the <a title="include location" href="#dt-include-location">include location</a> is dereferenced and the resource is fetched and transformed to a set of character information items. This feature facilitates the inclusion of working XML examples, as well as other text-based formats.</p><p>Resources that are unavailable for any reason (for example the resource doesn't exist, connection difficulties or security restrictions prevent it from being fetched, the URI scheme isn't a fetchable one, or the resource is in an unsupported encoding) result in a <a title="resource error" href="#dt-resource-error">resource error</a>.</p><p>The encoding of such a resource is determined <span class="deltaxml-old" style="background:#FF5555">by</span><span class="deltaxml-new" style="background:#90EE90">as follows (terminology as defined in sections 2.2 and 2.3 of </span><a href="#RFC7303"><span class="deltaxml-new" style="background:#90EE90">[IETF RFC 7303]</span></a><span class="deltaxml-new" style="background:#90EE90">)</span>:</p><ul><li><p><span class="deltaxml-old" style="background:#FF5555">external encoding information, if available, otherwise</span></p><p><span class="deltaxml-new" style="background:#90EE90">If external (out-of-band) information supplies encoding information, it is used.</span></p></li><li><p><span class="deltaxml-old" style="background:#FF5555">if the media type of the resource indicates, according to XML Media Types </span><a href="#RFC3023"><span class="deltaxml-old" style="background:#FF5555">[IETF RFC 3023]</span></a><span class="deltaxml-old" style="background:#FF5555">, that the resource is XML, for example </span><code><span class="deltaxml-old" style="background:#FF5555">text/xml</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code><span class="deltaxml-old" style="background:#FF5555">application/xml</span></code><span class="deltaxml-old" style="background:#FF5555"> or matches </span><code><span class="deltaxml-old" style="background:#FF5555">text/*+xml</span></code><span class="deltaxml-old" style="background:#FF5555"> or </span><code><span class="deltaxml-old" style="background:#FF5555">application/*+xml</span></code><span class="deltaxml-old" style="background:#FF5555">, then the encoding is determined as specified in </span><a href="#XML"><span class="deltaxml-old" style="background:#FF5555">[XML 1.0]</span></a><span class="deltaxml-old" style="background:#FF5555"> or </span><a href="#XML11"><span class="deltaxml-old" style="background:#FF5555">[XML 1.1]</span></a><span class="deltaxml-old" style="background:#FF5555"> section 4.3.3, as appropriate, otherwise</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, by cases, depending on whether, and if so what, MIME information is available:</span></p><ul><li><p><span class="deltaxml-new" style="background:#90EE90">For XML MIME entities:</span></p><ul><li><p><span class="deltaxml-new" style="background:#90EE90">follow the guidelines given in section 3.2 of </span><a href="#RFC7303"><span class="deltaxml-new" style="background:#90EE90">[IETF RFC 7303]</span></a><span class="deltaxml-new" style="background:#90EE90"> or its successors;</span></p></li></ul></li><li><p><span class="deltaxml-new" style="background:#90EE90">For MIME entities which are not XML MIME entities:</span></p><ul><li><p><span class="deltaxml-new" style="background:#90EE90">As determined by a BOM (see Section 3.3 of </span><a href="#RFC7303"><span class="deltaxml-new" style="background:#90EE90">[IETF RFC 7303]</span></a><span class="deltaxml-new" style="background:#90EE90">) if it is present;</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">In the absence of a BOM (Section 3.3), as determined by the charset parameter if it is present.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">In the absence of a charset parameter, the value of the </span><code><span class="deltaxml-new" style="background:#90EE90">encoding</span></code><span class="deltaxml-new" style="background:#90EE90"> attribute on the </span><code><span class="deltaxml-new" style="background:#90EE90">xi:include</span></code><span class="deltaxml-new" style="background:#90EE90"> element, if it exists.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, UTF-8</span></p></li></ul></li><li><p><span class="deltaxml-new" style="background:#90EE90">For non-MIME entities:</span></p><ul><li><p><span class="deltaxml-new" style="background:#90EE90">If external (out-of-band) information identifies them as XML, then according to section 4.3.3 of </span><a href="#XML"><span class="deltaxml-new" style="background:#90EE90">[XML 1.0]</span></a><span class="deltaxml-new" style="background:#90EE90">;</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">If it is not identified as XML, the value of the </span><code><span class="deltaxml-new" style="background:#90EE90">encoding</span></code><span class="deltaxml-new" style="background:#90EE90"> attribute on the </span><code><span class="deltaxml-new" style="background:#90EE90">xi:include</span></code><span class="deltaxml-new" style="background:#90EE90"> element, if it exists.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, UTF-8.</span></p></li></ul></li></ul></li><li class="delete_version" style="display: none;"><p>the value of the <code>encoding</code> attribute if one exists, otherwise</p></li><li class="modify_version"><p><span class="deltaxml-old" style="background:#FF5555">the value of the </span><code><span class="deltaxml-old" style="background:#FF5555">encoding</span></code><span class="deltaxml-old" style="background:#FF5555"> attribute if one exists, otherwise</span></p></li><li class="delete_version" style="display: none;"><p>UTF-8.</p></li><li class="modify_version"><p><span class="deltaxml-old" style="background:#FF5555">UTF-8.</span></p></li></ul><p>Byte sequences outside the range allowed by the encoding are a <a title="fatal error" href="#dt-error">fatal error</a>. Characters that are not permitted in XML documents also are a <a title="fatal error" href="#dt-error">fatal error</a>.</p><p>Each character obtained from the transformation of the resource is represented in the <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> as a <em>character information item</em> with the <em>character code</em> set to the character code in ISO 10646 encoding, and the <em>element content whitespace</em> set to false.</p><p>When the first character is U+FEFF and is interpreted as a Byte-Order Mark, it should be discarded. It is interpreted as a BOM in UTF-8, UTF-16, and UTF-32 encodings; it is not interpreted as a BOM in the UTF-16LE, UTF-16BE, UTF-32LE, and UTF-32BE encodings.</p><p>The <a href="#CharMod">[Character Model]</a> discusses normalization of included text.</p></div><div class="div2"><h3><a name="other-included-items" id="other-included-items"></a>4.5 Included Items for other values of <code>parse</code></h3><p>When processing as neither XML nor text, the <a title="include location" href="#dt-include-location">include location</a> is dereferenced and the resource is fetched and transformed into information items through some implementation-defined process.</p><p>Resources that are unavailable for any reason (for example the resource doesn't exist, connection difficulties or security restrictions prevent it from being fetched, the URI scheme isn't a fetchable one, or the resource cannot be transformed into information items for some other reason) result in a <a title="resource error" href="#dt-resource-error">resource error</a>.</p><p>The interpretation of <code>fragid</code> attributes for other values of <code>parse</code> is implementation-defined.</p><p>Implementations may raise <a title="fatal error" href="#dt-error">fatal errors</a>; the circumstances that result in such errors are implementation-defined.</p></div><div class="div2"><h3><a name="fallback" id="fallback"></a>4.6 Fallback Behavior</h3><p>XInclude processors <a title="Must, May, etc." href="#dt-must">must</a> perform fallback behavior in the event of a <a title="resource error" href="#dt-resource-error">resource error</a>, as follows:</p><p>If the <em>children</em> of the <code>xi:include</code> element information item in the <a title="source infoset" href="#dt-source-infoset">source infoset</a> contain exactly one <code>xi:fallback</code> element, the <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> consist of the information items corresponding to the result of performing XInclude processing on the <em>children</em> of the <code>xi:fallback</code> element. It is a <a title="fatal error" href="#dt-error">fatal error</a> if there is zero or more than one <code>xi:fallback</code> element.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Fallback content is not dependent on the value of the <code>parse</code> attribute. The <code>xi:fallback</code> element can contain markup even when processing text. Likewise, it can contain a simple string when processing XML.</p></div></div><div class="div2"><h3><a name="creating-result" id="creating-result"></a>4.7 Creating the Result Infoset</h3><p>The result infoset is a copy of the source infoset, with each <code>xi:include</code> element processed as follows:</p><p>The information item for the <code>xi:include</code> element is found. [<a name="dt-include-parent" id="dt-include-parent" title="include parent">Definition</a>: The <em>parent</em> property of this item refers to an information item called the <b>include parent</b>.] The <em>children</em> property of the <a title="include parent" href="#dt-include-parent">include parent</a> is modified by replacing the <code>xi:include</code> element information item with the <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a>. The <em>parent</em> property of each included item is set to the <a title="include parent" href="#dt-include-parent">include parent</a>.</p><p>It is a fatal error to attempt to replace an <code>xi:include</code> element appearing as the document (top-level) element in the source infoset with something other than a list of zero or more comments, zero or more processing instructions, and one element.</p><p>Some processors may not be able to represent an element's <em>in-scope namespaces</em> property if it does not include bindings for all the prefixes bound in its parent's <em>in-scope namespaces</em>. Such processors <a title="Must, May, etc." href="#dt-must">may</a> therefore include additional namespace bindings inherited from the <a title="include parent" href="#dt-include-parent">include parent</a> in the <em>in-scope namespaces</em> of the <a title="included items" href="#dt-included-items">included items</a>.</p><p>The inclusion history of each <a title="top-level included items" href="#dt-top-level-included-items">top-level included item</a> is recorded in the extension property <em>include history</em>. The <em>include history</em> property is a list of <em>element information items</em>, representing the <code>xi:include</code> elements for recursive levels of inclusion. If an <em>include history</em> property already appears on a <a title="top-level included items" href="#dt-top-level-included-items">top-level included item</a>, the <code>xi:include</code> element information item is prepended to the list. If no <em>include history</em> property exists, then this property is added with the single value of the <code>xi:include</code> element information item.</p><p>The <a title="included items" href="#dt-included-items">included items</a> will all appear in the result infoset. This includes <em>unexpanded entity reference information items</em> if they are present.</p><p>Intra-document references within <code>xi:include</code> elements are resolved against the source infoset. The effect of this is that the order in which <code>xi:include</code> elements are processed does not affect the result.</p><p>In the following example, the second include always points to the first <code>xi:include</code> element and not to itself, regardless of the order in which the includes are processed. Thus the result of this inclusion is two copies of <code>something.xml</code>, and does not produce an inclusion loop error.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;x xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;xi:include href="something.xml"/&gt;

  &lt;xi:include xpointer="element(x/1)"
              parse="application/xml"/&gt;
&lt;/x&gt;
</pre></div><p>An XInclude processor <a title="Must, May, etc." href="#dt-must">may</a>, at user option, suppress <code>xml:base</code> and/or <code>xml:lang</code> fixup.</p><div class="div3"><h4><a name="unparsed-entities" id="unparsed-entities"></a>4.7.1 Unparsed Entities</h4><p>Any <em>unparsed entity information item</em> appearing in the <em>references</em> property of an attribute on the <a title="included items" href="#dt-included-items">included items</a> or any descendant thereof is added to the <em>unparsed entities</em> property of the <a title="result infoset" href="#dt-result-infoset">result infoset</a>'s <em>document information item</em>, if it is not a duplicate of an existing member. Duplicates do not appear in the result infoset.</p><p>Unparsed entity items with the same <em>name</em>, <em>system identifier</em>, <em>public identifier</em>, <em>declaration base URI</em>, <em>notation name</em>, and <em>notation</em> are considered to be duplicate. An application <a title="Must, May, etc." href="#dt-must">may</a> also be able to detect that unparsed entities are duplicate through other means. For instance, the URI resulting from combining the system identifier and the declaration base URI is the same.</p><p>It is a <a title="fatal error" href="#dt-error">fatal error</a> to include unparsed entity items with the same name, but which are not determined to be duplicates.</p></div><div class="div3"><h4><a name="notations" id="notations"></a>4.7.2 Notations</h4><p>Any <em>notation information item</em> appearing in the <em>references</em> property of an attribute in the <a title="included items" href="#dt-included-items">included items</a> or any descendant thereof is added to the <em>notations</em> property of the <a title="result infoset" href="#dt-result-infoset">result infoset</a>'s <em>document information item</em>, if it is not a duplicate of an existing member. Likewise, any notation referenced by an unparsed entity added as described in <a href="#unparsed-entities"><b>4.7.1 Unparsed Entities</b></a>, is added unless it is a duplicate. Duplicates do not appear in the result infoset.</p><p>Notation items with the same <em>name</em>, <em>system identifier</em>, <em>public identifier</em>, and <em>declaration base URI</em> are considered to be duplicate. An application <a title="Must, May, etc." href="#dt-must">may</a> also be able to detect that notations are duplicate through other means. For instance, the URI resulting from combining the system identifier and the declaration base URI is the same.</p><p>It is a <a title="fatal error" href="#dt-error">fatal error</a> to include notation items with the same name, but which are not determined to be duplicates.</p></div><div class="div3"><h4><a name="references-property" id="references-property"></a>4.7.3 <em>references</em> Property Fixup</h4><p>During inclusion, an <em>attribute information item</em> whose <em>attribute type</em> property is IDREF or IDREFS has a <em>references</em> property with zero or more element values from the source or included infosets. These values <a title="Must, May, etc." href="#dt-must">must</a> be adjusted to correspond to element values that occur in the result infoset. During this process, XInclude also corrects inconsistencies between the <em>references</em> property and the <em>attribute type</em> property, which might arise in the following circumstances:</p><ul><li><p>A document fragment contains an IDREF pointing to an element in the included document but outside the part being included. In this case there is no element in the result infoset that corresponds to the element value in the original <em>references</em> property.</p></li><li><p>A document or document fragment is not self-contained. That is, it contains IDREFs which do not refer to an element within that document or document fragment, with the intention that these references will be realized after inclusion. In this case, the value of the <em>references</em> property is unknown or has no value.</p></li><li><p>The result infoset has ID clashes - that is, more than one attribute with <em>attribute type</em> ID with the same <em>normalized value</em>. In this case, attributes with <em>attribute type</em> IDREF or IDREFS with the same <em>normalized value</em> might have different values for their <em>references</em> properties.</p></li></ul><p>In resolving these inconsistencies, XInclude takes the <em>attribute type</em> property as definitive. In the result infoset, the value of the <em>references</em> property of an <em>attribute information item</em> whose <em>attribute type</em> property is IDREF or IDREFS is adjusted as follows:</p><p>For each token in the <em>normalized value</em> property, the <em>references</em> property contains an <em>element information item</em> with the same properties as the <em>element information item</em> in the result infoset with an attribute with <em>attribute type</em> ID and <em>normalized value</em> equal to the token. The order of the elements in the <em>references</em> property is the same as the order of the tokens appearing in the <em>normalize value</em>. If for any of the token values, no element or more than one element is found, the <em>references</em> property has no value.</p></div><div class="div3"><h4><a name="namespaces" id="namespaces"></a>4.7.4 Namespace Fixup</h4><p>The <em>in-scope namespaces</em> property ensures that namespace scope is preserved through inclusion. However, after inclusion, the <em>namespace attributes</em> property might not provide the full list of namespace declarations necessary to interpret qualified names in attribute or element content in the result. It is therefore not recommended that XInclude processors expose <em>namespace attributes</em> in the result. If this is unavoidable, the implementation <a title="Must, May, etc." href="#dt-must">may</a> add <em>attribute information items</em> to the <em>namespace attributes</em> property in order to approximate the information conveyed by <em>in-scope namespaces</em>.</p></div><div class="div3"><h4><a name="base" id="base"></a>4.7.5 Base URI Fixup</h4><p>The base URI property of the acquired infoset is not changed as a result of merging the infoset, and remains unchanged after merging. Thus relative URI references in the included infoset resolve to the same URI despite being included into a document with a potentially different base URI in effect. <code>xml:base</code> attributes are added to the result infoset to indicate this fact.</p><p>Each <em>element information item</em> in the <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> which has a different <em>base URI</em> than its <a title="include parent" href="#dt-include-parent">include parent</a> has an <em>attribute information item</em> added to its <em>attributes</em> property. This attribute has the following properties:</p><ol class="enumar"><li><p>A <em>namespace name</em> of <code>http://www.w3.org/XML/1998/namespace</code>.</p></li><li><p>A <em>local name</em> of <code>base</code>.</p></li><li><p>A <em>prefix</em> of <code>xml</code>.</p></li><li><p>A <em>normalized value</em> equal to either the <em>base URI</em> of the element, or an equivalent URI reference relative to the <em>base URI</em> of the include parent. The circumstances in which a relative URI is desirable, and how to compute such a relative URI, are implementation-dependent.</p></li><li><p>A <em>specified</em> flag indicating that this attribute was actually specified in the start-tag of its element.</p></li><li><p>An <em>attribute type</em> of <code>CDATA</code>.</p></li><li><p>A <em>references</em> property with no value.</p></li><li><p>An <em>owner element</em> of the information item of the element.</p></li></ol><p>If an <code>xml:base</code> attribute information item is already present, it is replaced by the new attribute.</p></div><div class="div3"><h4><a name="language" id="language"></a>4.7.6 Language Fixup</h4><p>While the <code>xml:lang</code> attribute is described as inherited by XML, the XML Information Set makes no provision for preserving the inheritance of this property through document composition such as XInclude provides. This section introduces a <em>language</em> property which records the scope of <code>xml:lang</code> information in order to preserve it during inclusion.</p><p>An XInclude processor <a title="Must, May, etc." href="#dt-must">should</a> augment the <a title="source infoset" href="#dt-source-infoset">source infoset</a> and the <a title="acquired infoset" href="#dt-acquired-infoset">acquired infoset</a> by adding the <em>language</em> property to each <em>element information item</em>. The value of this property is the <em>normalized value</em> of the <code>xml:lang</code> attribute appearing on that element if one exists, with <code>xml:lang=""</code> resulting in no value, otherwise it is the value of the <em>language</em> property of the element's parent element if one exists, otherwise the property has no value.</p><p>Each <em>element information item</em> in the <a title="top-level included items" href="#dt-top-level-included-items">top-level included items</a> which has a different value of <em>language</em> than its <a title="include parent" href="#dt-include-parent">include parent</a> (taking case-insensitivity into account per <a href="#RFC3066">[IETF RFC 3066]</a>), or that has a value if its <a title="include parent" href="#dt-include-parent">include parent</a> is a <em>document information item</em>, has an <em>attribute information item</em> added to its <em>attributes</em> property. This attribute has the following properties:</p><ol class="enumar"><li><p>A <em>namespace name</em> of <code>http://www.w3.org/XML/1998/namespace</code>.</p></li><li><p>A <em>local name</em> of <code>lang</code>.</p></li><li><p>A <em>prefix</em> of <code>xml</code>.</p></li><li><p>A <em>normalized value</em> equal to the <em>language</em> property of the element. If the <em>language</em> property has no value, the normalized value is the empty string.</p></li><li><p>A <em>specified</em> flag indicating that this attribute was actually specified in the start-tag of its element.</p></li><li><p>An <em>attribute type</em> of <code>CDATA</code>.</p></li><li><p>A <em>references</em> property with no value.</p></li><li><p>An <em>owner element</em> of the information item of the element.</p></li></ol><p>If an <code>xml:lang</code> attribute information item is already present, it is replaced by the new attribute.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The <code>xml:space</code> attribute is not treated specially by XInclude.</p></div></div><div class="div3"><h4><a name="properties" id="properties"></a>4.7.7 Properties Preserved by the Infoset</h4><p>As an infoset transformation, XInclude operates on the logical structure of XML documents, not on their text serialization. All properties of an information item described in <a href="#XMLIS">[XML Information Set]</a> other than those specifically modified by this specification are preserved during inclusion. The <em>include history</em> and <em>language</em> properties introduced in this specification is also preserved. Extension properties such as <a href="#XMLSchemas">[XML Schemas]</a> Post Schema Validation Infoset (PSVI) properties are discarded by default. However, an XInclude processor <a title="Must, May, etc." href="#dt-must">may</a>, at user option, preserve these properties in the resulting infoset if they are correct according to the specification describing the semantics of the extension properties.</p><p>For instance, the PSVI <em>validity</em> property describes the conditions of ancestors and descendants. Modification of ancestors and descendants during the XInclude process can render the value of this property inaccurate. By default, XInclude strips this property, but by user option the property could be recalculated to obtain a semantically accurate value. Precisely how this is accomplished is outside the scope of this specification.</p></div></div></div><div class="div1"><h2><a name="conformance" id="conformance"></a>5 Conformance</h2><div class="div2"><h3><a name="markup" id="markup"></a>5.1 Markup Conformance</h3><p>An <em>element information item</em> conforms to this specification if it meets the structural requirements for include elements defined in this specification. This specification imposes no particular constraints on DTDs or XML schemas; conformance applies only to elements and attributes.</p></div><div class="div2"><h3><a name="application" id="application"></a>5.2 Application Conformance</h3><p>An application conforms to XInclude if it:</p><ul><li><p>supports <a href="#XML">[XML 1.0]</a> and <a href="#XMLNS">[Namespaces in XML]</a> or <a href="#XML11">[XML 1.1]</a> and <a href="#XMLNS11">[Namespaces in XML 1.1]</a>, the <a href="#XMLIS">[XML Information Set]</a>, <a href="#XMLBase">[XML Base]</a>, the <a href="#XPCore">[XPointer Framework]</a>, and the <a href="#XPElement">[XPointer element() scheme]</a>;</p></li><li><p>stops processing when a <a title="fatal error" href="#dt-error">fatal error</a> is encountered;</p></li><li><p>observes the mandatory conditions (<a title="Must, May, etc." href="#dt-must">must</a>) set forth in this specification, and for any optional conditions (<a title="Must, May, etc." href="#dt-must">should</a> and <a title="Must, May, etc." href="#dt-must">may</a>) it chooses to observe, observes them in the way prescribed; and</p></li><li><p>performs markup conformance testing according to all the conformance constraints appearing in this specification.</p></li></ul><p>Support for the <a href="#XPointer">[XPointer xpointer() Scheme]</a> is not mandatory for full XInclude conformance. Authors are advised that use of XPointer schemes other than element() might not be supported by all conformant XInclude implementations.</p></div><div class="div2"><h3><a name="infoset" id="infoset"></a>5.3 XML Information Set Conformance</h3><p>This specification conforms to the <a href="#XMLIS">[XML Information Set]</a>. The following information items <a title="Must, May, etc." href="#dt-must">must</a> be present in the input infosets to enable correct processing:</p><ul><li><p><em>Document information items</em> with <em>children</em> and <em>base URI</em> properties.</p></li><li><p><em>Element information items</em> with <em>namespace name</em>, <em>local name</em>, <em>children</em>, <em>attributes</em>, <em>base URI</em> and <em>parent</em> properties.</p></li><li><p><em>Attribute information items</em> with <em>namespace name</em>, <em>local name</em> and <em>normalized value</em> properties.</p></li></ul><p>Additionally, XInclude processing might generate the following kinds of information items in the result:</p><ul><li><p><em>Character information items</em> with <em>character code</em>, <em>element content whitespace</em> and <em>parent</em> properties.</p></li></ul><p>XInclude extends the infoset with the property <em>include history</em>, which <a title="Must, May, etc." href="#dt-must">may</a> appear on the following types of information items in the result:</p><ul><li><p><em>Element information items</em>.</p></li><li><p><em>Processing instruction information items</em>.</p></li><li><p><em>Comment information items</em>.</p></li><li><p><em>Character information items</em>.</p></li></ul><p>XInclude also extends the infoset with the property <em>language</em>, which <a title="Must, May, etc." href="#dt-must">may</a> appear on <em>element information items</em> in the result.</p></div></div></div><div class="back"><div class="div1"><h2><a name="references" id="references"></a>A References</h2><dl><dt class="label"><a name="RFC2119" id="RFC2119"></a>IETF RFC 2119</dt><dd><a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>RFC 2119: Key words for use in RFCs to Indicate Requirement Levels</cite></a>. Internet Engineering Task Force, 1997. (See http://www.ietf.org/rfc/rfc2119.txt.)</dd><dt class="label"><a name="RFC3629" id="RFC3629"></a>IETF RFC 3629</dt><dd><a href="http://www.ietf.org/rfc/rfc3629.txt"><cite>RFC 3629: UTF-8, a transformation format of ISO 10646</cite></a>. Internet Engineering Task Force, 2003. (See http://www.ietf.org/rfc/rfc3629.txt.)</dd><dt class="label"><a name="RFC2396" id="RFC2396"></a>IETF RFC 2396</dt><dd><a href="http://www.ietf.org/rfc/rfc2396.txt"><cite>RFC 2396: Uniform Resource Identifiers</cite></a>. Internet Engineering Task Force, 1995. (See http://www.ietf.org/rfc/rfc2396.txt.)</dd><dt class="label"><a name="RFC2732" id="RFC2732"></a>IETF RFC 2732</dt><dd><a href="http://www.ietf.org/rfc/rfc2732.txt"><cite>RFC 2732: Format for Literal IPv6 Addresses in URL's</cite></a>. Internet Engineering Task Force, 1999. (See http://www.ietf.org/rfc/rfc2732.txt.)</dd><dt class="label"><a name="RFC3023" id="RFC3023"></a><a name="RFC3987" id="RFC3987"></a>IETF RFC <span class="deltaxml-old" style="background:#FF5555">3023</span><span class="deltaxml-new" style="background:#90EE90">3987</span></dt><dd><a href="http://www.ietf.org/rfc/rfc3023.txt"><cite><span class="deltaxml-old" style="background:#FF5555">RFC 3023: XML Media Types</span></cite></a><span class="deltaxml-old" style="background:#FF5555">. Internet Engineering Task Force, 2001. (See http://www.ietf.org/rfc/rfc3023.txt.)</span></dd><dt class="label"><a name="RFC3987" id="RFC3987"></a><span class="deltaxml-old" style="background:#FF5555">IETF RFC 3987</span></dt><dd><a href="http://www.ietf.org/rfc/rfc3987.txt"><cite>RFC 3987: Internationalized Resource Identifiers (IRIs)</cite></a>. Internet Engineering Task Force, 2005. (See http://www.ietf.org/rfc/rfc3987.txt.)</dd><dt class="label"><a name="RFC4288" id="RFC4288"></a>IETF RFC 4288</dt><dd><a href="http://www.ietf.org/rfc/rfc4288.txt"><cite>RFC 4288: Media Type Specifications and Registration Procedures</cite></a>. Internet Engineering Task Force, 2005. (See http://www.ietf.org/rfc/rfc4288.txt.)</dd><dt class="label"><a name="RFC5147" id="RFC5147"></a>IETF RFC 5147</dt><dd><a href="http://www.ietf.org/rfc/rfc5147.txt"><cite>RFC 5147: URI Fragment Identifiers for the text/plain Media Type</cite></a>. Internet Engineering Task Force, 2008. (See http://www.ietf.org/rfc/rfc5147.txt.)</dd><dt class="label"><a name="RFC7303" id="RFC7303"></a><span class="deltaxml-new" style="background:#90EE90">IETF RFC 7303</span></dt><dd><a href="http://www.ietf.org/rfc/rfc7303.txt"><cite><span class="deltaxml-new" style="background:#90EE90">RFC 7303: XML Media Types</span></cite></a><span class="deltaxml-new" style="background:#90EE90">. Internet Engineering Task Force, 2014. (See http://www.ietf.org/rfc/rfc7303.txt.)</span></dd><dt class="label"><a name="Unicode" id="Unicode"></a>Unicode</dt><dd>The Unicode Consortium. <a href="http://www.unicode.org/unicode/standard/versions/"><cite>The Unicode Standard, Version 4.0.</cite></a> Reading, Mass.: Addison-Wesley, 2003, as updated from time to time by the publication of new versions. (See <a href="http://www.unicode.org/unicode/standard/versions/">http://www.unicode.org/unicode/standard/versions/</a> for the latest version and additional information on versions of the standard and of the Unicode Character Database).</dd><dt class="label"><a name="XML" id="XML"></a>XML 1.0</dt><dd>Tim Bray, Jean Paoli, C.M. Sperberg-McQueen, Eve Maler, François Yergeau, editors. <a href="http://www.w3.org/TR/2004/REC-xml-20040204/"><cite>Extensible Markup Language (XML) 1.0 (Third Edition)</cite></a>, World Wide Web Consortium, 2004. (See http://www.w3.org/TR/2004/REC-xml-20040204/.)</dd><dt class="label"><a name="XML11" id="XML11"></a>XML 1.1</dt><dd>Tim Bray, Jean Paoli, C.M. Sperberg-McQueen, Eve Maler, François Yergeau, John Cowan, editors. <a href="http://www.w3.org/TR/2004/REC-xml11-20040204/"><cite>Extensible Markup Language (XML) 1.1</cite></a>, World Wide Web Consortium, 2004. (See http://www.w3.org/TR/2004/REC-xml11-20040204/.)</dd><dt class="label"><a name="XMLBase" id="XMLBase"></a>XML Base</dt><dd>Jonathan Marsh, editor. <a href="http://www.w3.org/TR/2001/REC-xmlbase-20010627/"><cite>XML Base</cite></a>. World Wide Web Consortium, 2001. (See http://www.w3.org/TR/2001/REC-xmlbase-20010627/.)</dd><dt class="label"><a name="XMLIS" id="XMLIS"></a>XML Information Set</dt><dd>John Cowan and Richard Tobin, editors. <a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/"><cite>XML Information Set (Second Edition)</cite></a>. World Wide Web Consortium, 2004. (See http://www.w3.org/TR/2004/REC-xml-infoset-20040204/.)</dd><dt class="label"><a name="XMLNS" id="XMLNS"></a>Namespaces in XML</dt><dd>Tim Bray, Dave Hollander, and Andrew Layman, editors. <a href="http://www.w3.org/TR/1999/REC-xml-names-19990114/"><cite>Namespaces in XML</cite></a>. World Wide Web Consortium, 1999. (See http://www.w3.org/TR/1999/REC-xml-names-19990114/.)</dd><dt class="label"><a name="XMLNS11" id="XMLNS11"></a>Namespaces in XML 1.1</dt><dd>Tim Bray, Dave Hollander, Andrew Layman, Richard Tobin, editors. <a href="http://www.w3.org/TR/2004/REC-xml-names11-20040204/"><cite>Namespaces in XML 1.1</cite></a>. World Wide Web Consortium, 2004. (See http://www.w3.org/TR/2004/REC-xml-names11-20040204/.)</dd><dt class="label"><a name="XPCore" id="XPCore"></a>XPointer Framework</dt><dd>Paul Grosso, Eve Maler, Jonathan Marsh, Norman Walsh, editors. <a href="http://www.w3.org/TR/2003/REC-xptr-framework-20030325/"><cite>XPointer Framework</cite></a>. World Wide Web Consortium, 2003. (See http://www.w3.org/TR/2003/REC-xptr-framework-20030325/.)</dd><dt class="label"><a name="XPElement" id="XPElement"></a>XPointer element() scheme</dt><dd>Paul Grosso, Eve Maler, Jonathan Marsh, Norman Walsh, editors. <a href="http://www.w3.org/TR/2003/REC-xptr-element-20030325/"><cite>XPointer element() Scheme</cite></a>. World Wide Web Consortium, 2003. (See http://www.w3.org/TR/2003/REC-xptr-element-20030325/.)</dd></dl></div><div class="div1"><h2><a name="nn-refs" id="nn-refs"></a>B References (Non-Normative)</h2><dl><dt class="label"><a name="RFC2616" id="RFC2616"></a>IETF RFC 2616</dt><dd><a href="http://www.ietf.org/rfc/rfc2616.txt"><cite>RFC 2616: Hypertext Transfer Protocol -- HTTP/1.1</cite></a>. Internet Engineering Task Force, 1999. (See http://www.ietf.org/rfc/rfc2616.txt.)</dd><dt class="label"><a name="RFC3066" id="RFC3066"></a>IETF RFC 3066</dt><dd><a href="http://www.ietf.org/rfc/rfc3066.txt"><cite>RFC 3066: Tags for the Identification of Languages</cite></a>. Internet Engineering Task Force, 2001. (See http://www.ietf.org/rfc/rfc3066.txt.)</dd><dt class="label"><a name="XInclude-note" id="XInclude-note"></a>XML Inclusion Proposal</dt><dd>Jonathan Marsh, David Orchard, editors. <a href="http://www.w3.org/TR/1999/NOTE-xinclude-19991123"><cite>XML Inclusion Proposal (XInclude).</cite></a> World Wide Web Consortium, 2004. (See http://www.w3.org/TR/1999/NOTE-xinclude-19991123.)</dd><dt class="label"><a name="XLink" id="XLink"></a>XML Linking Language</dt><dd>Steve DeRose, Eve Maler, David Orchard, and Ben Trafford, editors. <a href="http://www.w3.org/TR/2001/REC-xlink-20010627/"><cite>XML Linking Language (XLink).</cite></a> World Wide Web Consortium, 2001. (See http://www.w3.org/TR/2001/REC-xlink-20010627/.)</dd><dt class="label"><a name="XPointer" id="XPointer"></a>XPointer xpointer() Scheme</dt><dd>Steve DeRose, Ron Daniel, Eve Maler, editors. <a href="http://www.w3.org/TR/2002/WD-xptr-xpointer-20021219/"><cite>XPointer xpointer() Scheme</cite></a>. World Wide Web Consortium, 2002. (See http://www.w3.org/TR/2002/WD-xptr-xpointer-20021219/.)</dd><dt class="label"><a name="XPath" id="XPath"></a>XPath 1.0</dt><dd>James Clark, Steve DeRose, editors. <a href="http://www.w3.org/TR/1999/REC-xpath-19991116"><cite>XML Path Language (XPath) Version 1.0.</cite></a> World Wide Web Consortium, 1999. (See http://www.w3.org/TR/1999/REC-xpath-19991116.)</dd><dt class="label"><a name="CharMod" id="CharMod"></a>Character Model</dt><dd>Martin J. Dürst, François Yergeau, Misha Wolf, Asmus Freytag, Tex Texin. <a href="http://www.w3.org/TR/charmod-norm/"><cite>Character Model for the World Wide Web 1.0: Normalization</cite></a>. World Wide Web Consortium, 2001. (See http://www.w3.org/TR/charmod-norm/.)</dd><dt class="label"><a name="XMLSchemas" id="XMLSchemas"></a>XML Schemas</dt><dd>Henry S. Thompson, David Beech, Murray Maloney, Noah Mendelsohn, editors. <a href="http://www.w3.org/TR/2001/REC-xmlschema-1-20010502/"><cite>XML Schema Part 1: Structures.</cite></a> World Wide Web Consortium, 2001. (See http://www.w3.org/TR/2001/REC-xmlschema-1-20010502/.)</dd><dt class="label"><a name="XSL-FO" id="XSL-FO"></a>XSL-FO</dt><dd>Sharon Adler <em>et al</em>. <a href="http://www.w3.org/TR/2001/REC-xsl-20011015/"><cite>Extensible Stylesheet Language (XSL)</cite></a>. World Wide Web Consortium, 2001. (See http://www.w3.org/TR/2001/REC-xsl-20011015/.)</dd><dt class="label"><a name="XHTML" id="XHTML"></a>XHTML</dt><dd>Steven Pemberton <em>et al</em>. <a href="http://www.w3.org/TR/2002/REC-xhtml1-20020801/"><cite>XHTML 1.0 The Extensible HyperText Markup Language (Second Edition)</cite></a>. World Wide Web Consortium, 2002. (See http://www.w3.org/TR/2002/REC-xhtml1-20020801/.)</dd></dl></div><div class="div1"><h2><a name="examples" id="examples"></a>C Examples (Non-Normative)</h2><div class="div2"><h3><a name="basic-example" id="basic-example"></a>C.1 Basic Inclusion Example</h3><p>The following XML document contains an <code>xi:include</code> element which points to an external document. Assume the base URI of this document is <code>http://www.example.org/document.xml</code>.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;120 Mz is adequate for an average home user.&lt;/p&gt;
  &lt;xi:include href="disclaimer.xml"/&gt;
&lt;/document&gt;
</pre></div><p>disclaimer.xml contains:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;disclaimer&gt;
  &lt;p&gt;The opinions represented herein represent those of the individual
  and should not be interpreted as official policy endorsed by this
  organization.&lt;/p&gt;
&lt;/disclaimer&gt;
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;120 Mz is adequate for an average home user.&lt;/p&gt;
  &lt;disclaimer xml:base="http://www.example.org/disclaimer.xml"&gt;
  &lt;p&gt;The opinions represented herein represent those of the individual
  and should not be interpreted as official policy endorsed by this
  organization.&lt;/p&gt;
&lt;/disclaimer&gt;
&lt;/document&gt;
</pre></div></div><div class="div2"><h3><a name="text-example" id="text-example"></a>C.2 Textual Inclusion Example</h3><p>The following XML document includes a "working example" into a document.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;This document has been accessed
  &lt;xi:include href="count.txt" parse="text/plain"/&gt; times.&lt;/p&gt;
&lt;/document&gt;
</pre></div><p>where count.txt contains:</p><div class="exampleInner"><pre xml:space="preserve">
324387
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;This document has been accessed
  324387 times.&lt;/p&gt;
&lt;/document&gt;
</pre></div></div><div class="div2"><h3><a name="xml-as-text-example" id="xml-as-text-example"></a>C.3 Textual Inclusion of XML Example</h3><p>The following XML document includes a "working example" into a document.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;The following is the source of the "data.xml" resource:&lt;/p&gt;
  &lt;example&gt;&lt;xi:include href="data.xml" parse="text/plain"/&gt;&lt;/example&gt;
&lt;/document&gt;
</pre></div><p>data.xml contains:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;data&gt;
  &lt;item&gt;&lt;![CDATA[Brooks &amp; Shields]]&gt;&lt;/item&gt;
&lt;/data&gt;
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;The following is the source of the "data.xml" resource:&lt;/p&gt;
  &lt;example&gt;&amp;lt;?xml version='1.0'?&amp;gt;
&amp;lt;data&amp;gt;
  &amp;lt;item&amp;gt;&amp;lt;![CDATA[Brooks &amp;amp; Shields]]&amp;gt;&amp;lt;/item&amp;gt;
&amp;lt;/data&amp;gt;&lt;/example&gt;
&lt;/document&gt;
</pre></div></div><div class="div2"><h3><a name="fragment-example" id="fragment-example"></a>C.4 Fragment Inclusion Example</h3><p>The following illustrates the results of including fragments of another XML document. Assume the base URI of the document is <code>http://www.example.com/JoeSmithQuote.xml</code>.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;price-quote xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;prepared-for&gt;Joe Smith&lt;/prepared-for&gt;
  &lt;good-through&gt;20040930&lt;/good-through&gt;
  &lt;xi:include href="price-list.xml" xpointer="w002-description"/&gt;
  &lt;volume&gt;40&lt;/volume&gt;
  &lt;xi:include href="price-list.xml" xpointer="element(w002-prices/2)"/&gt;
&lt;/price-quote&gt;
</pre></div><p>price-list.xml references a DTD which declares the <code>id</code> attributes as type <code>ID</code>, and contains:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;!DOCTYPE price-list SYSTEM "price-list.dtd"&gt;
&lt;price-list xml:lang="en-us"&gt;
  &lt;item id="w001"&gt;
    &lt;description id="w001-description"&gt;
      &lt;p&gt;Normal Widget&lt;/p&gt;
    &lt;/description&gt;
    &lt;prices id="w001-prices"&gt;
      &lt;price currency="USD" volume="1+"&gt;39.95&lt;/price&gt;
      &lt;price currency="USD" volume="10+"&gt;34.95&lt;/price&gt;
      &lt;price currency="USD" volume="100+"&gt;29.95&lt;/price&gt;
    &lt;/prices&gt;
  &lt;/item&gt;
  &lt;item id="w002"&gt;
    &lt;description id="w002-description"&gt;
      &lt;p&gt;Super-sized widget with bells &lt;i&gt;and&lt;/i&gt; whistles.&lt;/p&gt;
    &lt;/description&gt;
    &lt;prices id="w002-prices"&gt;
      &lt;price currency="USD" volume="1+"&gt;59.95&lt;/price&gt;
      &lt;price currency="USD" volume="10+"&gt;54.95&lt;/price&gt;
      &lt;price currency="USD" volume="100+"&gt;49.95&lt;/price&gt;
    &lt;/prices&gt;
  &lt;/item&gt;
&lt;/price-list&gt;
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;price-quote xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;prepared-for&gt;Joe Smith&lt;/prepared-for&gt;
  &lt;good-through&gt;20040930&lt;/good-through&gt;
  &lt;description id="w002-description" xml:lang="en-us"
               xml:base="http://www.example.com/price-list.xml"&gt;
    &lt;p&gt;Super-sized widget with bells &lt;i&gt;and&lt;/i&gt; whistles.&lt;/p&gt;
  &lt;/description&gt;
  &lt;volume&gt;40&lt;/volume&gt;
  &lt;price currency="USD" volume="10+" xml:lang="en-us"
         xml:base="http://www.example.com/price-list.xml"&gt;54.95&lt;/price&gt;
&lt;/price-quote&gt;
</pre></div></div><div class="div2"><h3><a name="text-example-2" id="text-example-2"></a>C.6 Textual Inclusion Examples with RFC5147 Fragment Identifiers</h3><p>The following XML document includes several lines of a code listing.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
&lt;p&gt;This example includes just the ‘use' lines from a Perl script.&lt;/p&gt;
&lt;pre&gt;&lt;xi:include parse="text/plain" fragid="line=2,6" href="code.pl"/&gt;&lt;/pre&gt;
&lt;p&gt;There are four of them.&lt;/p&gt;
&lt;/document&gt;
</pre></div><p>where code.pl contains:</p><div class="exampleInner"><pre xml:space="preserve">
#!/usr/bin/perl -- # --*-Perl-*--

use strict;
use English;
use Getopt::Std;
use vars qw($opt_p $opt_q $opt_u $opt_m);

my $usage = "Usage: $0 [-q] [-u|-p|-m] file [ file ... ]\n";

die $usage if ! getopts('qupm');

die $usage if ($opt_p + $opt_u + $opt_m) != 1;

my $file = shift @ARGV || die $usage;

my $opt = '-u' if $opt_u;
$opt = '-p' if $opt_p;
$opt = '-m' if $opt_m;

while ($file) {
    print "Converting $file to $opt linebreaks.\n" if !$opt_q;
    open (F, "$file");
    binmode F;
    read (F, $_, -s $file);
    close (F);

    s/\r\n/\n/sg;
    s/\r/\n/sg;

    if ($opt eq '-p') {
        s/\n/\r\n/sg;
    } elsif ($opt eq '-m') {
        s/\n/\r/sg;
    }

    open (F, "&gt;$file");
    binmode F;
    print F $_;
    close (F);

    $file = shift @ARGV;
}
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
&lt;p&gt;This example includes just the ‘use' lines from a Perl script.&lt;/p&gt;
&lt;pre&gt;use strict;
use English;
use Getopt::Std;
use vars qw($opt_p $opt_q $opt_u $opt_m);
&lt;/pre&gt;
&lt;p&gt;There are four of them.&lt;/p&gt;
&lt;/document&gt;
</pre></div><p>This XML document includes a range of characters from the same code listing.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
&lt;p&gt;This example includes a range of characters.&lt;/p&gt;
&lt;pre&gt;&lt;xi:include parse="text/plain" fragid="char=100,200;length=758,UTF-8" href="code.pl"/&gt;&lt;/pre&gt;
&lt;/document&gt;
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
&lt;p&gt;This example includes a range of characters.&lt;/p&gt;
&lt;pre&gt;_q $opt_u $opt_m);

my $usage = "Usage: $0 [-q] [-u|-p|-m] file [ file ... ]\n";

die $usage if ! ge&lt;/pre&gt;
&lt;/document&gt;
</pre></div></div><div class="div2"><h3><a name="att-copy-example" id="att-copy-example"></a>C.7 Attribute Copying Examples</h3><p>The following XML document includes the same element twice, using attribute copying to allow a subsequent process to distinguish them.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:eg="http://example.org/namespace/example"&gt;
&lt;p&gt;This example includes a “definition” paragraph from some document
twice using attribute copying.&lt;/p&gt;

&lt;xi:include eg:root="one" href="src.xml" xpointer="element(def)"/&gt;

&lt;xi:include eg:root="two" href="src.xml" xpointer="element(def)"/&gt;

&lt;/document&gt;
</pre></div><p>where <code>src.xml</code> contains:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;document&gt;
  &lt;para&gt;Some paragraph.&lt;/para&gt;
  &lt;para xml:id="def"&gt;Some definition.&lt;/para&gt;
  &lt;para&gt;Some other paragraph.&lt;/para&gt;
&lt;/document&gt;
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:eg="http://example.org/namespace/example"&gt;
&lt;p&gt;This example includes a “definition” paragraph from some document
twice using attribute copying.&lt;/p&gt;

&lt;para eg:root="one" xml:id="def"&gt;Some definition.&lt;/para&gt;

&lt;para eg:root="two" xml:id="def"&gt;Some definition.&lt;/para&gt;

&lt;/document&gt;
</pre></div><p>The following example demonstrates how <span><code>set-xml-id</code> can be used to change <code>xml:id</code> values</span>. As before, the following XML document includes the same element twice, using attribute copying to allow a subsequent process to distinguish them.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:eg="http://example.org/namespace/example"&gt;
&lt;p&gt;This example shows attribute replacement.&lt;/p&gt;

&lt;xi:include eg:root="one" <span>set-xml-id</span>="inc1" href="src-2.xml" xpointer="element(note)"/&gt;

&lt;xi:include eg:root="two" <span>set-xml-id</span>="inc2" href="src-2.xml" xpointer="element(note)"/&gt;

&lt;/document&gt;
</pre></div><p>where <code>src-2.xml</code> contains:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;document&gt;
  &lt;note xml:id="note"&gt;&lt;p&gt;Consider the &lt;phrase xml:id="wombat"&gt;Wombat&lt;/phrase&gt;.&lt;/p&gt;&lt;/note&gt;
&lt;/document&gt;
</pre></div><p>The infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:eg="http://example.org/namespace/example"&gt;
&lt;p&gt;This example shows attribute replacement.&lt;/p&gt;

&lt;note eg:root="one" xml:id="inc1"&gt;&lt;p&gt;Consider the &lt;phrase xml:id="wombat"&gt;Wombat&lt;/phrase&gt;.&lt;/p&gt;&lt;/note&gt;

&lt;note eg:root="two" xml:id="inc2"&gt;&lt;p&gt;Consider the &lt;phrase xml:id="wombat"&gt;Wombat&lt;/phrase&gt;.&lt;/p&gt;&lt;/note&gt;

&lt;/document&gt;
</pre></div><p>Observe that the <code>xml:id</code> attribute on the included <code>note</code> element has been replaced by <span>the <code>set-xml-id</code> value</span> from the <code>xi:include</code> element. <span>The <code>set-xml-id</code> attribute</span> has no effect on descendants. Subsequent fixup will still be required in order to make this document valid. Additional fixup would also be required if the resulting document contained any IDREF pointers to the now missing “<code>note</code>” ID.</p></div><div class="div2"><h3><a name="fallback-example" id="fallback-example"></a>C.8 Fallback Example</h3><p>The following XML document relies on the fallback mechanism to succeed in the event that the resources <code>example.txt</code> and <code>fallback-example.txt</code> are not available.</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;div&gt;
  &lt;xi:include href="example.txt" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
    &lt;xi:fallback&gt;&lt;xi:include href="fallback-example.txt" parse="text/plain"&gt;
        &lt;xi:fallback&gt;&lt;a href="mailto:bob@example.org"&gt;Report error&lt;/a&gt;&lt;/xi:fallback&gt;
      &lt;/xi:include&gt;&lt;/xi:fallback&gt;
  &lt;/xi:include&gt;
&lt;/div&gt;
</pre></div><p>If neither <code>example.txt</code> nor <code>fallback-example.txt</code> are available, the infoset resulting from resolving inclusions on this document is the same (except for the <em>include history</em> and <em>language</em> properties) as that of the following document:</p><div class="exampleInner"><pre xml:space="preserve">
&lt;?xml version='1.0'?&gt;
&lt;div&gt;
  &lt;a href="mailto:bob@example.org"&gt;Report error&lt;/a&gt;
&lt;/div&gt;
</pre></div></div><div class="div2"><h3><a name="text-encoding-example" id="text-encoding-example"></a><span class="deltaxml-new" style="background:#90EE90">C.9 Textual Inclusion Encoding Example</span></h3><p><span class="deltaxml-new" style="background:#90EE90">The following XML document specifies the encoding of the included text document. See </span><a href="#text-included-items"><b><span class="deltaxml-new" style="background:#90EE90">4.4 Included Items when processing text</span></b></a><span class="deltaxml-new" style="background:#90EE90">.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;This document is about
  &lt;xi:include href="city.txt" parse="text/plain" encoding="ISO-8859-1"/&gt;.&lt;/p&gt;
&lt;/document&gt;
</span></pre></div><p><span class="deltaxml-new" style="background:#90EE90">where city.txt contains:</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">
München
</span></pre></div><p><span class="deltaxml-new" style="background:#90EE90">(Encoded in ISO-8859-1, of course.)</span></p><p><span class="deltaxml-new" style="background:#90EE90">The infoset resulting from resolving inclusions on this document is the same (except for the </span><em><span class="deltaxml-new" style="background:#90EE90">include history</span></em><span class="deltaxml-new" style="background:#90EE90"> and </span><em><span class="deltaxml-new" style="background:#90EE90">language</span></em><span class="deltaxml-new" style="background:#90EE90"> properties) as that of the following document:</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">
&lt;?xml version='1.0'?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;p&gt;This document is about
  München.&lt;/p&gt;
&lt;/document&gt;
</span></pre></div></div></div></div></body></html>